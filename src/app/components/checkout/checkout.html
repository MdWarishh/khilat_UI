<div class="checkout-page">

  <div class="checkout-container">

    <h1 class="page-title">Checkout</h1>

    <div class="checkout-layout">

      <!-- Left: Form -->
      <div class="shipping-form">

        <div class="section-header">
          <h2>Shipping & Billing Details</h2>
        </div>

        <form (ngSubmit)="onSubmit()" #checkoutForm="ngForm">

          <div class="form-group">
            <label>Full Name <span class="required">*</span></label>
            <input type="text" [(ngModel)]="form.fullName" name="fullName" required
                   [class.invalid]="formSubmitted && !form.fullName">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email <span class="required">*</span></label>
              <input type="email" [(ngModel)]="form.email" name="email" required
                     [class.invalid]="formSubmitted && (!form.email || !isValidEmail(form.email))">
            </div>
            <div class="form-group">
              <label>Phone <span class="required">*</span></label>
              <input type="tel" [(ngModel)]="form.phone" name="phone" required pattern="\d{10}"
                     [class.invalid]="formSubmitted && (!form.phone || !isValidPhone(form.phone))">
            </div>
          </div>

          <div class="form-group">
            <label>Address Line 1 <span class="required">*</span></label>
            <input type="text" [(ngModel)]="form.addressLine1" name="addressLine1" required
                   [class.invalid]="formSubmitted && !form.addressLine1">
          </div>

          <div class="form-group">
            <label>Address Line 2 (optional)</label>
            <input type="text" [(ngModel)]="form.addressLine2" name="addressLine2">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City <span class="required">*</span></label>
              <input type="text" [(ngModel)]="form.city" name="city" required
                     [class.invalid]="formSubmitted && !form.city">
            </div>
            <div class="form-group">
              <label>State <span class="required">*</span></label>
              <input type="text" [(ngModel)]="form.state" name="state" required
                     [class.invalid]="formSubmitted && !form.state">
            </div>
            <div class="form-group">
              <label>Pincode <span class="required">*</span></label>
              <input type="text" [(ngModel)]="form.pincode" name="pincode" required pattern="\d{6}"
                     maxlength="6" [class.invalid]="formSubmitted && (!form.pincode || form.pincode.length !== 6)">
            </div>
          </div>

          <div class="error-msg" *ngIf="errorMessage">{{ errorMessage }}</div>

          <button type="submit" class="btn-proceed" [disabled]="loading">
            <span *ngIf="!loading">Proceed to Payment</span>
            <span *ngIf="loading">Processing...</span>
          </button>
        </form>
      </div>

      <!-- Right: Order Summary -->
      <div class="order-summary">
        <div class="summary-header">
          <h3>Order Summary</h3>
        </div>

        <div class="items-list">
          <div class="summary-item" *ngFor="let item of cartItems">
            <div class="item-info">
              <span class="item-name">{{ item.name }}</span>
              <span class="item-qty">Qty: {{ item.qty }}</span>
            </div>
            <span class="item-price">₹{{ item.price * item.qty }}</span>
          </div>
        </div>

        <div class="summary-totals">
          <div class="total-row">
            <span>Subtotal</span>
            <span>₹{{ subtotal }}</span>
          </div>
          <div class="total-row">
            <span>Shipping</span>
            <span *ngIf="shipping === 0" class="free">FREE</span>
            <span *ngIf="shipping > 0">₹{{ shipping }}</span>
          </div>
          <div class="total-row grand-total">
            <span>Total</span>
            <span>₹{{ total }}</span>
          </div>
        </div>

        <div class="free-shipping-msg" *ngIf="subtotal < 999">
          Add ₹{{ 999 - subtotal }} more for free shipping
        </div>
      </div>
    </div>
  </div>
</div>